<!DOCTYPE html>
<html>
	<head>
		<title>Gamblers</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<link rel="stylesheet" href="jquery/tablesorter/themes/purple/style.css" />
		<style type="text/css">
			.hidden {
				display: none;
			}
			
			#tabs {
				font-family: Arial;
				font-size: 12px;
				border-bottom: 2px solid black;
			}
			#tabs a {
				border: 2px solid black;
				padding: 4px;
				background: lavender;
				text-decoration: none;
				color: black;
				display: inline-block;
				margin-bottom: -2px;
			}
			#tabs a.selected {
				font-weight: bold;
				border-bottom: none;
				padding-bottom: 6px;
				background: white;
			}
			#tabs a:not(.selected):hover {
				background: plum;
			}
		</style>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="jquery/jquery.tablesorter.js" type="text/javascript"></script>
		<script type="text/javascript">
			$leaderboard = {
				users: [],
				loadJSON: function (path, callback) {
					var xobj = new XMLHttpRequest();
					xobj.overrideMimeType("application/json");
					xobj.open('GET', path, true);
					xobj.onreadystatechange = function () {
						if (xobj.readyState == 4 && xobj.status == "200") {
							callback(xobj.responseText);
						}
					};
					xobj.send(null);
				},
				load: function (path) {
					$leaderboard.loadJSON(path, function (response) {
						var json = JSON.parse(response);
						var jusers = json.leaderboard;
						
						for (var i=0; i<jusers.length; ++i)
						{
							var juser = jusers[i];
							var name = Object.keys(juser)[0];
							var stats = juser[name];
							
							var user = {
								name: name,
								balance: stats[0],
								level: stats[1],
								numBets: stats[2],
								numWins: stats[3],
								numLosses: stats[4],
								numDraws: stats[5],
								numBegs: stats[6]
							};
							
							$leaderboard.users.push(user);
						}
						$leaderboard.updateTable();
					});
				},
				updateTable: function () {
					$('#tb').empty();
					for (var i=0; i<$leaderboard.users.length; ++i)
					{
						var user = $leaderboard.users[i];
						var name = user.name;

						var row = document.createElement("tr");

						var cell;

						cell = document.createElement("td");
						cell.innerHTML = name;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = user.balance;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = user.level;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = user.numBets;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = user.numWins;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = user.numLosses;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = user.numDraws;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = user.numBegs;
						row.appendChild(cell);

						$('#tb').append(row);
					}
				}
			};

			$history = {
				gambles: [],
				loadJSON: function (path, callback) {
					var xobj = new XMLHttpRequest();
					xobj.overrideMimeType("application/json");
					xobj.open('GET', path, true);
					xobj.onreadystatechange = function () {
						if (xobj.readyState == 4 && xobj.status == "200") {
							callback(xobj.responseText);
						}
					};
					xobj.send(null);
				},
				load: function (path) {
					$history.loadJSON(path, function (response) {
						var json = JSON.parse(response);
						var jgambles = json.gambles;
						
						for (var i=0; i<jgambles.length; ++i)
						{
							var jgamble = jgambles[i];
							
							var gamble = {
								startTime: new Date(jgamble[0] * 1000),
								endTime: new Date(jgamble[1] * 1000),
								maxBet: jgamble[2],
								choices: jgamble[3],
								totalBet: jgamble[4],
								numBets: jgamble[5],
								winChoice: jgamble[6],
								bets: jgamble[7]
							};
							
							$history.gambles.push(gamble);
						}
						$history.updateTable();
					});
				},
				updateTable: function () {
					$('#tb2').empty();
					for (var i=0; i<$history.gambles.length; ++i)
					{
						var gamble = $history.gambles[i];

						var row = document.createElement("tr");

						var cell;

						cell = document.createElement("td");
						cell.innerHTML = gamble.startTime.toLocaleString();
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = gamble.endTime.toLocaleString();
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = gamble.maxBet;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = gamble.choices;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = gamble.totalBet;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = gamble.numBets;
						row.appendChild(cell);

						cell = document.createElement("td");
						cell.innerHTML = gamble.winChoice;
						row.appendChild(cell);

						$('#tb2').append(row);
					}
				}
			};
			
			function showLeaderboard() {
				$('#leaderboard').removeClass('hidden');
				$('#gambles').addClass('hidden');
				$('#leaderboardTab').addClass('selected');
				$('#gamblesTab').removeClass('selected');
			}

			function showGambles() {
				$('#leaderboard').addClass('hidden');
				$('#gambles').removeClass('hidden');
				$('#leaderboardTab').removeClass('selected');
				$('#gamblesTab').addClass('selected');
			}

			window.onload = function () {
				$leaderboard.load('leaderboard.json');
				$history.load('gambles.json');
				
				$('#leaderboard').tablesorter({ widgets: ['zebra'], debug: true });
				$('#gambles').tablesorter({ widgets: ['zebra'], debug: true });
				$('#leaderboard').trigger("update");
				$('#leaderboard').trigger("sorton",[[[1,0]]]);
				$('#gambles').trigger("update");
				$('#gambles').trigger("sorton",[[[0,1]]]);
				
				showLeaderboard();
			};
			$(document).ready(function() 
				{ 
				} 
			);
		</script>
	</head>
	<body>
		<div id="tabs">
			<a id="leaderboardTab" href="#" onclick="showLeaderboard();return false;">Leaderboard</a>
			<a id="gamblesTab" href="#" onclick="showGambles();return false;">Gambles</a>
		</div>
		<table id="leaderboard" class="tablesorter">
			<thead>
				<tr>
					<th>Name</th>
					<th>Smackers</th>
					<th>Level</th>
					<th># bets</th>
					<th># wins</th>
					<th># losses</th>
					<th># draws</th>
					<th># begs</th>
				</tr>
			</thead>
			<tbody id="tb">
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</tbody>
		</table>
		<table id="gambles" class="tablesorter">
			<thead>
				<tr>
					<th>Start</th>
					<th>End</th>
					<th>Max bet</th>
					<th>Choices</th>
					<th>Smackers bet</th>
					<th># bets</th>
					<th>Winning choice</th>
				</tr>
			</thead>
			<tbody id="tb2">
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</tbody>
		</table>
	</body>
</html>
